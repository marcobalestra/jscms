AS.form.fields.jcpage=class extends AS.form.field{static buildValue(to,v){return to.prop.chosenValue=String(to.field.options[to.field.selectedIndex].value),AS.form.field.prototype.buildValue.call(to,to.prop.chosenValue)}static renderField(to){const cv=!!AS.test.obj(to.prop.value)&&to.prop.value.page+(to.prop.value.id||"");return to.field=document.createElement("select"),to.field.className="asFormField asFormFieldJcpage",to.field.setAttribute("id",to.prop.id),to.field.setAttribute("name",to.prop.name),to.field.setAttribute("placeholder",to.prop.placeholder),to.field.setAttribute("style","width:100%;"),to.field.asField=()=>to,jc.jdav.get("struct/_all-list.json",data=>{let $f=$(to.field);$f.append("<option></option>");let curpage=jc.page.current(),curid=String(jc.page.data().id||"");Object.keys(data).forEach(page=>{let ptype=data[page];Object.keys(ptype).forEach(id=>{let p=ptype[id];var v;id=parseInt(id)?id:"",!to.prop.includecurrent&&page==curpage&&id==curid||(v=page+id,$f.append(`<option value="${v}">[${page}${id}] ${p.title.escape()} â€” ${(p.desc||"").escape()}</option>`))})}),cv&&$f.val(cv),to.prop._s2v&&$f.val(to.prop._s2v),$f.select2({dropdownParent:$(to.getForm().fakeForm()).closest(".modal"),placeholder:AS.label("Select")}),$f.on("change",()=>{to.setValue(to.getJsValue()),AS.form.field.onchange(to)})}),AS.form.field.prototype.renderField.call(to)}getJsValue(){let v=this.field.options[this.field.selectedIndex].value;if(AS.test.obj(v))return v;if(AS.test.str(v)&&""!=v){let o={page:v.replace(/[0-9]+$/,"")};return v.match(/[0-9]+$/)&&(o.id=parseInt(v.replace(/^.*[^0-9]([0-9]+)$/,"$1"))),o}}parse(avs){var av=avs[this.prop.name];av&&(avs=av.page+(av.id||""),this.setValue(av),this.prop._s2v=avs,$(this.fakeField()).val(avs).trigger("change")),this.hideWarning()}renderField(){return AS.form.fields.jcpage.renderField.call(window,this)}postRender(){let $d=$(this.field).closest("div");return $d.css({padding:".5em 1em 1em 1em"}),AS.form.field.postRender.call(window,this)}};