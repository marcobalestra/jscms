jc.prop.lastHiEntry="",jc.prop.absUriMatcher=new RegExp("^([a-z]+:/)?/","i"),AS.test.udef(jc.prop.maxUploadSize)&&(jc.prop.maxUploadSize=8388608),AS.test.udef(jc.prop.uriPrefixPlain)&&(jc.prop.uriPrefixPlain="/-jscms/"),AS.test.udef(jc.prop.uriPrefixOfbs)&&(jc.prop.uriPrefixOfbs="/_jscms/"),AS.test.udef(jc.prop.useObsUri)&&(jc.prop.useObsUri=!1),AS.test.udef(jc.prop.mainContainerId)&&(jc.prop.mainContainerId="jcToplevelContainer"),AS.test.arr(jc.prop.lastChangedQuantities)||(jc.prop.lastChangedQuantities=[10,25,50,100]),AS.test.udef(jc.prop.prefs)&&(jc.prop.prefs={}),AS.test.udef(jc.prop.prefs.debugURI)&&(jc.prop.prefs.debugURI=!1),AS.test.udef(jc.prop.prefs.debugLevel)&&(jc.prop.prefs.debugLevel=0),AS.test.udef(jc.prop.prefs.prefsVersion)&&(jc.prop.prefs.prefsVersion=1),(()=>{let lp=AS.path("jsroot");var bp=AS.path("jscdn")||AS.path("jsroot");AS.test.udef(lp)&&(lp="/jscms/",AS.path({jsroot:lp})),AS.test.udef(AS.path("jstemplates"))&&AS.path({jstemplates:bp+"templates/"}),AS.test.udef(AS.path("jsrenderers"))&&AS.path({jsrenderers:AS.path("jstemplates")+"renderers/"}),AS.test.udef(AS.path("jsextensions"))&&AS.path({jsextensions:AS.path("jstemplates")+"extensions/"}),AS.test.udef(AS.path("jsdataroot"))&&AS.path({jsdataroot:lp+"data/"}),AS.test.udef(AS.path("jsdatapages"))&&AS.path({jsdatapages:AS.path("jsdataroot")+"pages/"}),AS.test.udef(AS.path("jsdatasite"))&&AS.path({jsdatasite:AS.path("jsdataroot")+"site/"}),AS.test.udef(AS.path("jsdatastatics"))&&AS.path({jsdatastatics:AS.path("jsdataroot")+"static/"}),AS.test.udef(AS.path("jsauth"))&&AS.path({jsauth:lp+"login/"}),AS.test.udef(AS.path("jsreporoot"))&&AS.path({jsreporoot:bp+"repository/"})})(),jc.prop.loadModules={basic:[AS.path("jscdn")+"css/jc.css",{type:"js",src:"https://cdn.jsdelivr.net/npm/sweetalert2@10"},{type:"js",src:"https:///cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.js"},"https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css","https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js","https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css","https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js","wait:()=>( window.Swal && jQuery.fn.select2 )"],edit:[AS.path("jscdn")+"js/jc-edit"+(jc.prop.isDeveloper?"":".min")+".js","https://cdn.altersoftware.org/js-as-form/as-form.js","wait:()=>( jc.edit && AS.form )"],maintenance:[AS.path("jscdn")+"js/jc-maintenance"+(jc.prop.isDeveloper?"":".min")+".js","wait:()=>( jc.maint )"],datatables:["https://cdn.datatables.net/v/dt/dt-1.10.24/date-1.0.3/sp-1.2.2/datatables.min.css","https://cdn.datatables.net/v/dt/dt-1.10.24/date-1.0.3/sp-1.2.2/datatables.min.js","wait:()=>((!! $.fn.dataTable) && (!! $.fn.fancybox) )"]},($=>{let re=/([^&=]+)=?([^&]*)/g,decodeRE=/\+/g,decode=function(str){return decodeURIComponent(str.replace(decodeRE," "))};$.parseParams=function(query){let params={},e;for(;e=re.exec(query);){let k=decode(e[1]),v=decode(e[2]);"[]"===k.substring(k.length-2)?(k=k.substring(0,k.length-2),(params[k]||(params[k]=[])).push(v)):params[k]=v}return params}})(jQuery),$(()=>{jc.prefs.init(),$.ajaxSetup({cache:!0}),jc.springLoad("module:basic");let foo=()=>{var sp;window.Swal&&jQuery.fn.select2?(window.name="jcmain",window.self==window.top&&(sp=jc.URI.decode(),AS.test.str(sp.page)?jc.page.open(sp.page,sp.id,sp.data):jc.page.open("index")),jc.autoAdjustFields()):window.setTimeout(foo,100)};foo()});var tp={};$(window).on("popstate",()=>{var sp;jc.page.prop.editMode||(sp=jc.URI.decode(),AS.test.str(sp.page)&&(jc.prop.lastHiEntry=jc.URI.encode(sp),jc.page.open(sp.page,sp.id,sp.data)))}),Date.prototype.clone||(Date.prototype.clone=function(){let d=new Date;return d.setTime(this.getTime()),d}),Date.prototype.tosqldate||(Date.prototype.tosqldate=function(){var a=this.getFullYear()+"-";let x=this.getMonth()+1;return a+=(x<10?"0"+x:x)+"-",x=this.getDate(),a+=x<10?"0"+x:x}),Date.prototype.toitadate||(Date.prototype.toitadate=function(){let x=this.getDate();var a=String(x<10?"0"+x:x)+".";return x=this.getMonth()+1,a+=(x<10?"0"+x:x)+"."+this.getFullYear()}),Date.prototype.tosql||(Date.prototype.tosql=function(){var a=this.tosqldate()+" ";let x=this.getHours();return a+=(x<10?"0"+x:x)+":",x=this.getMinutes(),a+=(x<10?"0"+x:x)+":",x=this.getSeconds(),a+=x<10?"0"+x:x}),Date.prototype.fromsql||(Date.prototype.fromsql=function(s){if(AS.test.str(s)&&s.match(/^([0-9]{4})/)){this.setMonth(0),this.setDate(10);let x=parseInt(s.match(/^([0-9]{4})/)[1]);isNaN(x)||(this.setFullYear(x),x=parseInt(s.match(/^[0-9]{4}[^0-9]?([0-9]{2})/)[1]),isNaN(x)||(this.setMonth(x-1),x=parseInt(s.match(/^[0-9]{4}[^0-9]?[0-9]{2}[^0-9]?([0-9]{2})/)[1]),isNaN(x)||this.setDate(x))),this.setHours(12,0,0,0),0<s.indexOf(" ")&&(x=parseInt(s.match(/ ([0-9]{2})/)[1]),isNaN(x)||(this.setHours(x),x=parseInt(s.match(/ [0-9]{2}[^0-9]?([0-9]{2})/)[1]),isNaN(x)||(this.setMinutes(x),x=parseInt(s.match(/([0-9]{2})$/)[1]),isNaN(x)||this.setSeconds(x))))}else AS.test.date(s)&&this.setTime(s.getTime());return this}),Date.prototype.getWeek||(Date.prototype.getWeek=function(){let target=new Date(this.valueOf());var dayDiff=(this.getDay()+6)%7;target.setDate(target.getDate()-dayDiff+3);dayDiff=new Date(target.getFullYear(),0,4),dayDiff=(target-dayDiff)/864e5;return(new Date(target.getFullYear(),0,1).getDay()<5?1:0)+Math.ceil(dayDiff/7)}),Date.prototype.jcparser=function(d){if(AS.test.date(d))return this.setTime(d.getTime()),this;if(AS.test.str(d)){if(d.match(/^2[0-9]{3}/))return this.fromsql(d);let k=new Date(d);if(AS.test.date(k))return this.setTime(k.getTime()),this}else if(AS.test.num(d))return this.setTime(d),this;return this},Date.prototype.fromita||(Date.prototype.fromita=function(s){return this.fromsql(jc.date2sql(s))}),Date.prototype.toblogdate||(Date.prototype.toblogdate=function(){return this.toLocaleDateString(navigator.language,{weekday:"long",year:"numeric",month:"long",day:"numeric"}).replace(/^([a-z])/,x=>x.toUpperCase()).replace(/([^a-z])([a-z])/gi,(a,x,y)=>x+y.toUpperCase())}),jc.objFind=(o,p,v)=>{if(AS.test.arr(o))return o.find(x=>jc.objFind(x,p,v));if(AS.test.obj(o)){if(o[p])return o[p]==v?o:void 0;var f=Object.keys(o).find(x=>jc.objFind(o[x],p,v));if(f)return jc.objFind(o[f],p,v)}},jc.objFindAll=(mo,p,v)=>{let out=[];const s=o=>{if(AS.test.arr(o))return o.filter(x=>s(x));if(AS.test.obj(o)){if(AS.test.def(o[p]))return void(o[p]!=v&&!AS.test.udef(v)||out.push(o));Object.keys(o).forEach(x=>s(o[x]))}};return s(mo),out},jc.getError=(jqXHR,status,e)=>{jc.console(jqXHR,status,e)},jc.sql2date=d=>AS.test.date(d)?d:(new Date).fromsql(d),jc.date2ita=d=>{if("string"==typeof d){if(d.match(/^[0-9]{4}[^0-9]/))return d.replace(/^([0-9]{4})[^0-9]([0-9]{2})[^0-9]([0-9]{2})$/,"$3.$2.$1");if(d.match(/[^0-9][0-9]{4}$/))return d}return d&&"object"==typeof d&&"function"==typeof d.toitadate?d.toitadate():"number"==typeof d?(new Date).setTime(d).toitadate():void 0},jc.date2sql=d=>{if("string"==typeof d){if(d.match(/[^0-9][0-9]{4}$/))return d.replace(/^([0-9]{2})[^0-9]([0-9]{2})[^0-9]([0-9]{4})$/,"$3-$2-$1");if(d.match(/^[0-9]{4}[^0-9]/))return d}return"object"==typeof d&&"function"==typeof d.tosqldate?d.tosqldate():"number"==typeof d?(new Date).setTime(d).tosqldate():void 0},jc.springLoad=(...sources)=>{let cs=[];sources.forEach(src=>{if(AS.test.str(src)&&0==src.indexOf("module:")){let ms=jc.prop.loadModules[src.replace(/^module:/,"")];ms&&("string"==typeof ms&&(ms=[ms]),ms.forEach(m=>{cs.push(m)}))}else cs.push(src)});let ns=[],ps=[],wait=!1;if(cs.forEach(src=>{wait?ps.push(src):AS.test.str(src)&&0==src.indexOf("wait:")?wait=src.replace(/^wait:/,""):ns.push(src)}),ns.forEach(src=>{if(src)return AS.test.obj(src)&&"js"==src.type&&src.src?jc.springLoadJs(src.src):AS.test.obj(src)&&"css"==src.type&&src.src?jc.springLoadCss(src.src):src.match(/\.css$/i)?jc.springLoadCss(src):src.match(/\.js$/i)?jc.springLoadJs(src):void jc.console("jc.springLoad unknown element: "+src)}),wait&&0<ps.length){let waiter=()=>{let e,flag;try{flag=eval(wait)}catch(e){flag=String(wait)}let pause=10;"function"==typeof flag?(flag=flag.call(window),flag&&(pause=0)):"number"==typeof flag?(pause=parseInt(flag),flag=!0):"string"==typeof flag&&(flag=void 0!==window[flag],flag&&(pause=0)),flag?window.setTimeout(()=>{jc.springLoad.apply(window,ps)},pause):window.setTimeout(waiter,pause)};waiter()}},jc.springLoadCss=(...sources)=>{let h=document.documentElement.querySelector("head");sources.forEach(src=>{if(src&&!document.documentElement.querySelector(`link[href="${src}"]`)){jc.console("Loading CSS:",src);let s=document.createElement("link");s.setAttribute("type","text/css"),s.setAttribute("rel","stylesheet"),s.setAttribute("spring-load","true"),s.setAttribute("href",src),h.appendChild(s)}})},jc.springLoadJs=(...sources)=>{let h=document.documentElement.querySelector("head");sources.forEach(src=>{if(src&&!document.documentElement.querySelector(`script[src="${src}"]`)){jc.console("Loading JS:",src);let s=document.createElement("script");s.setAttribute("type","text/javascript"),s.setAttribute("spring-load","true"),s.setAttribute("src",src),h.appendChild(s)}})},jc.fileSize=n=>1048576<n?String(Math.round(10*n/1048576)/10)+" MiB":1024<n?String(Math.round(n/1024))+" KiB":String(n)+"B",jc.evalFunc=f=>{if(AS.test.func(f))return f;if(AS.test.str(f)){let exc;try{let ft=eval(f);if(AS.test.func(ft))return ft}catch(exc){}}return!1},jc.login=(success,fail)=>{fail=jc.evalFunc(fail)||jc.evalFunc(success)||jc.getError,success=jc.evalFunc(success)||(()=>{}),jc.jdav.get(AS.path("jsauth")+"auth/username",(d,err)=>{jc.prop.authUser=d?d.username:void 0,d.username?AS.setCookie("jcAuthUser",d.username,{path:"/",sameSite:!0}):AS.rmCookie("jcAuthUser"),d?success.call(window,d):fail.call(window,d,err)})},jc.progress=msg=>{let mod=$("#jcProgressIndicator"),first=!1;0==mod.length&&(first=!0,mod=$(AS.label("modalProgress")),$(document.body).append(mod),mod=$("#jcProgressIndicator")),AS.test.str(msg)?($(".progressMessage",mod).html(msg),mod.modal("handleUpdate"),!first&&mod.hasClass("in")||mod.modal({backdrop:"static",keyboard:!1,show:!0})):mod.modal("hide").remove()},jc.progressbar=options=>{if(!jc.prop.progressbar)return jc.prop.progressbar=Swal.fire({toast:!0,title:'<div class="jcProgressbar"></div>',html:" ",position:"top-end",showConfirmButton:!1}),setTimeout(()=>{jc.progressbar(options)},10),jc.prop.progressbar;if(options&&options.close)return setTimeout(()=>{try{Swal.close()}catch(e){}try{jc.prop.progressbar._destroy()}catch(e){}delete jc.prop.progressbar},10),!1;if(options){let newopts={};if(options.text&&(newopts.html=`${options.text}`),options.prog&&(newopts.title=`<div class="jcProgressbar"><div style="width:${100*options.prog}%;"></div></div>`),jc.prop.progressbar&&Swal.isVisible()&&Object.keys(newopts).length)try{jc.prop.progressbar.update(newopts)}catch(e){}}return jc.prop.progressbar},jc.dav={get:(url,success,fail)=>{fail=jc.evalFunc(fail)||jc.evalFunc(success)||jc.getError,success=jc.evalFunc(success)||(()=>{}),url.match(jc.prop.absUriMatcher)||(url=AS.path("jsdataroot")+url),jc.console("jc.dav.get",url),$.ajax(url,{method:"GET",cache:!1,dataType:"text",error:(...errs)=>{fail.call(window,!1,errs)},success:data=>{success.call(window,data)}})},info:(url,success,fail)=>{fail=jc.evalFunc(fail)||jc.evalFunc(success)||jc.getError,success=jc.evalFunc(success)||(()=>{}),url.match(jc.prop.absUriMatcher)||(url=AS.path("jsdataroot")+url),jc.console("jc.dav.info",url),$.ajax(url,{method:"PROPFIND",cache:!1,contentType:"text/xml; charset=UTF-8",dataType:"text",error:(...errs)=>{fail.call(window,!1,errs)},success:xt=>{let data={uri:url};xt=xt.replace(/[\r\n]+/g," "),data.href=xt.replace(/^.+:href>([^<]+)<\/[^:]+:href>.+$/,"$1"),data.size=parseInt(xt.replace(/^.+:getcontentlength>([0-9]+)<\/[^:]+:getcontentlength>.+$/,"$1")),success.call(window,data)}})}},jc.jdav={get:(url,success,fail)=>{fail=jc.evalFunc(fail)||jc.evalFunc(success)||jc.getError,success=jc.evalFunc(success)||(()=>{}),url.match(jc.prop.absUriMatcher)||(url=AS.path("jsdataroot")+url),jc.console("jc.jdav.get",url),$.ajax(url,{method:"GET",cache:!1,dataType:"json",error:(...errs)=>{fail.call(window,!1,errs)},success:data=>{success.call(window,data)}})}},Object.keys(jc.dav).forEach(k=>{AS.test.udef(jc.jdav[k])&&(jc.jdav[k]=jc.dav[k])}),jc.menu=(ev,menu)=>{ev.preventDefault(),ev.stopPropagation();let zapMenus=()=>{document.querySelectorAll(".appContextMenu").forEach(el=>{$(el).fadeOut(10,()=>{$(el).remove()})}),$(".appContextHighlight").removeClass("appContextHighlight"),$(".appContextHighlightTent").remove(),$(".appContextActive").removeClass("appContextActive"),$(document.body).off("click contextmenu",zapMenus)};zapMenus();let testNode=n=>"string"==typeof n||"html"==typeof n||n instanceof Node||n instanceof NodeList||n instanceof jQuery;if((Array.isArray(menu)||testNode(menu))&&(menu={content:menu}),"object"==typeof menu){menu.type||(menu.type="context");let $cm=$('<div class="dropdown clearfix appContextMenu"></div>');if($cm.appendTo(document.body),testNode(menu.content))$cm.append(menu.content);else{if(!Array.isArray(menu.content))return $cm.remove(),void jc.console("jc.menu error",e,menu);{let $ul=$('<ul class="dropdown-menu appContextMenuContent" role="menu" aria-labelledby="dropdownMenu" style="max-width:'+$(window.width)+'px;"></ul>'),parseli=v=>{let $li=$("<li></li>");if("string"==typeof v)"-"==v?$li.html("<hr />"):$li.addClass("title").html(v);else{if("object"!=typeof v)return"";{let e,lab="",ricon=v.ricon||"",riconKey=v.riconKey||"";void 0===v.ricon&&"string"==typeof v.action&&(ricon=(v.download?"icon-download4":v.target&&"icon-square-up-right")||"icon-arrow-right16",riconKey=(v.download?"download":v.target&&"newwin")||"arrow-right"),ricon&&riconKey?lab+='<i class="rIcon '+ricon+'">'+AS.icon(riconKey)+"</i>":ricon&&(lab+='<i class="rIcon '+ricon+'"></i>'),v.icon&&v.iconKey?lab+='<i class="'+v.icon+'">'+AS.icon(v.iconKey)+"</i>":v.icon&&(lab+='<i class="'+v.icon+'"></i>'),v.label&&(lab+=v.label),"string"==typeof v.title&&$li.attr("title",v.title);try{let eva=eval(v.action);"function"==typeof eva&&(v.action=eva)}catch(e){}if("function"==typeof v.action){let $a=$("<a>"+lab+"</a>");$a.on("contextmenu click",lev=>{lev.preventDefault(),lev.stopPropagation(),v.action.call(window,ev,lev),zapMenus()}),$a.addClass("clickable"),$li.append($a)}else if("string"==typeof v.action){let $a=$('<a href="'+v.action+'">'+lab+"</a>");v.download&&$a.attr("download",v.download),v.target&&$a.attr("target",v.target),$a.addClass("clickable"),$li.append($a)}else $li.addClass("disabled").append("<a>"+lab+"</a>")}}if(Array.isArray(v.content)&&v.content.length){let $sul=$("<ul></ul>");v.content.forEach(c=>{$sul.append(parseli(c))}),$li.addClass("subMenu"),$li.append($sul)}return $li};menu.content.forEach(v=>{$ul.append(parseli(v))}),$cm.append($ul)}}let left,top,cmw=$cm.width(),cmh=$cm.height();if("button"==menu.type){menu.parent||(menu.parent=menu.highlight||"button");let $parent=$(ev.target).closest(menu.parent),pos=$parent.offset();left=menu.x||Math.floor(pos.left-2),top=menu.y||Math.floor(pos.top-2),top-$(window).scrollTop()+cmh>=$(window).height()&&(top=Math.ceil(pos.top+$parent.outerHeight()-cmh),$("ul.appContextMenuContent",$cm).append(Array.from($("ul.appContextMenuContent>li",$cm)).reverse())),left-$(window).scrollLeft()+cmw>=$(window).width()&&(left=Math.ceil(pos.left+$parent.outerWidth()-$cm.width()+1))}else if("menu"==menu.type){menu.sticky=!0,menu.parent||(menu.parent=menu.highlight||"a");let $parent=$(ev.target).closest(menu.parent),pos=$parent.offset();left=menu.x||Math.floor(pos.left),top=menu.y||Math.floor(pos.top+$parent.outerHeight()-2),top-$(window).scrollTop()+cmh>=$(window).height()&&(top=Math.ceil(pos.top-cmh+2),$("ul.appContextMenuContent",$cm).append(Array.from($("ul.appContextMenuContent>li",$cm)).reverse())),left-$(window).scrollLeft()+cmw>=$(window).width()&&(left=Math.ceil(pos.left+$parent.outerWidth()-cmw+1)),$parent.addClass("appContextActive")}else left=menu.x||ev.pageX-20,top=menu.y||ev.pageY-20,top-$(window).scrollTop()+cmh>=$(window).height()&&(top-=cmh-40,$("ul.appContextMenuContent",$cm).append(Array.from($("ul.appContextMenuContent>li",$cm)).reverse())),left-$(window).scrollLeft()+cmw>=$(window).width()&&(left-=cmw-40);left<0&&(left=0),top<0&&(top=0);let hl=!1;if(menu.highlight?hl=$(ev.target).closest(menu.highlight):void 0===menu.highlight&&(hl=$(ev.target)),hl){let os=hl.offset(),w=hl.width(),h=hl.height();$(`<div class="appContextHighlightTent" style="top:${os.top}px;left:${os.left}px;width:${w}px;height:${h}px;"> </div>`).appendTo(document.body),hl.addClass("appContextHighlight")}$(document.body).on("click contextmenu",zapMenus),$cm.css({transition:`all ${menu.duration||100}ms`,transform:`translateY(${parseInt(ev.pageY-top-cmh/2)}px) scaleY(0)`,left:`${left}px`,top:`${top}px`,display:"block"});let rmtrans=e=>{menu.sticky||$cm.on("mouseleave",zapMenus),$(e.target).off("transitionend",rmtrans).css({transition:"unset",transform:"unset"})};$cm.on("transitionend",rmtrans),window.setTimeout(()=>{$cm.css({transform:"translateY(0) scaleY(1)"})},0)}},jc.makeInputDate=input_fields=>{let fs=$(input_fields);if(0!=fs.length){if(void 0===jc.prop.browserCanHandleDatePicker){let input=document.createElement("input");input.setAttribute("type","date"),input.value="2018-01-01",jc.prop.browserCanHandleDatePicker=!!input.valueAsDate,input.remove()}fs.each((idx,el)=>{let f=$(el);if(!f.data("jc._fieldParsed"))if(f.data("jc._fieldParsed",!0),f.attr("disabled")||f.attr("readonly"))f.val()&&f.val(jc.date2ita(f.val()));else{let dtype="date";"time"!=f.attr("type")&&"time"!=f.data("type")||(dtype="time"),jc.prop.browserCanHandleDatePicker?(f.attr("type",dtype),f.on("change",()=>{f.val(jc.date2sql(f.val())||"")})):"date"==dtype?(f.val()&&f.val(jc.date2ita(f.val())),f.on("change",()=>{var idate=jc.date2ita(f.val()||"");f.datepicker("setValue",idate),f.val(idate)}),f.attr("type","text").datepicker({format:"dd.mm.yyyy",emptytext:"Data",language:"it",todayBtn:!0,todayHighlight:!0}).on("show",e=>{$(e.target).data("datepicker").picker.css("z-index","999999")})):"time"==dtype&&(f.attr("placeholder")||f.attr("placeholder","hh:mm"),f.attr("type","text").on("change",jc.adjustTimeFieldValue))}})}},jc.autoSelect2=input_fields=>{let fs=$(input_fields);fs.each((idx,el)=>{let f=$(el);f.attr("disabled")||f.attr("readonly")||f.data("jc._fieldParsed")||(f.data("jc._fieldParsed",!0),f.data("ajax")?f.select2({allowClear:!0,ajax:{url:f.data("ajax"),dataType:"json",delay:250,data:params=>{let p=f.data("ajax_params")||{};return p.q=params.term,p},processResults:(data,params)=>({results:data.items}),cache:!f.data("ajax_nocache")}}):f.select2({tags:f.data("tags")}))})},jc.autoAdjustFields=d=>{void 0===d&&(d=document.body),jc.makeInputDate($('input[type="date"],input[type="time"]',d)),jc.autoSelect2($("select.autoSelect2",d))},jc.URI={decode:()=>{let parsitems,fakepath="",l=window.location.href.replace(/#.*/,"");if(0<=l.indexOf(jc.prop.uriPrefixPlain))parsitems=l.substr(window.location.href.indexOf(jc.prop.uriPrefixPlain)+jc.prop.uriPrefixPlain.length);else{if(!(0<=l.indexOf(jc.prop.uriPrefixOfbs)))return{};parsitems=l.substr(window.location.href.indexOf(jc.prop.uriPrefixOfbs)+jc.prop.uriPrefixOfbs.length)}0<parsitems.indexOf("/")&&(fakepath=parsitems.replace(/^.+\/(.*)$/,"$1"),parsitems=parsitems.replace(/\/[^\/]*$/,"")),0<=l.indexOf(jc.prop.uriPrefixOfbs)&&(parsitems=window.atob(parsitems)),parsitems=parsitems.split(",");let pars={page:decodeURIComponent(parsitems.shift())};return""==pars.page?{}:(parsitems.length&&(pars.data={},parsitems.forEach(kv=>{kv=kv.split(":");pars.data[kv[0]]=decodeURIComponent(kv[1]).replace(/\+/g," ")})),pars.page.match(/[0-9]+$/)&&(pars.id=parseInt(pars.page.replace(/^.*[^0-9]([0-9]+)$/,"$1")),pars.page=pars.page.replace(/[0-9]+$/,"")),fakepath.length&&(AS.test.udef(pars.data)&&(pars.data={}),pars.data._fakepath=fakepath),jc.console("Decoded location:",pars),pars)},encode:(o,title,parsdata)=>{let uri="";if(AS.test.obj(o)){if(!AS.test.str(o.page||o.type))return"/";uri+=encodeURIComponent(o.page||o.type),o.id&&(uri+=o.id),AS.test.obj(o.data)&&(!o.id&&o.data&&o.data.id&&(uri+=o.data.id),AS.test.obj(parsdata)&&Object.keys(parsdata).sort().forEach(k=>{uri+=","+k+":"+encodeURIComponent(parsdata[k]).replace(/\%20/g,"+")}))}else AS.test.str(o)&&(uri=encodeURIComponent(o));return uri=jc.prop.useObsUri?jc.prop.uriPrefixOfbs+window.btoa(uri):jc.prop.uriPrefixPlain+uri,AS.test.def(title)?uri+="/"+title.toLowerCase().replace(/[^a-z0-9._]+/g," ").trim().replace(/ +/g,"-"):o.data&&o.data._fakepath&&(uri+="/"+o.data._fakepath),jc.console("Encoded location:",uri),uri},push:title=>{let uriparams={};jc.page.current()&&(uriparams.page=jc.page.current(),up=jc.page.data(),AS.test.obj(jc.page.data())&&(uriparams.data=up),AS.test.udef(title)&&up.pageContent&&up.pageContent.metadata&&(up.pageContent.metadata.url?title=up.pageContent.metadata.url:up.id&&up.pageContent.metadata.title&&(title=up.pageContent.metadata.title)));var up=jc.URI.encode(uriparams,title,jc.page.data().args);up!=jc.prop.lastHiEntry&&(jc.prop.lastHiEntry=up,history.pushState({},title,up))},current:title=>{AS.test.str(title)?document.title=title:AS.test.udef(title)&&(title=$("#appAction").html()||document.title),history.replaceState({},title,jc.URI.encode(jc.URI.decode()))}},jc.def={arr:x=>{var d=AS.test.def(x);return d&&AS.test.arr(x)?x:d?[x]:[]},bool:x=>!!AS.test.bool(x)&&x,num:x=>{var d=AS.test.def(x);return d&&AS.test.num(x)?x:d?parseFloat(x):0},obj:x=>AS.test.obj(x)?x:{},str:x=>AS.test.def(x)?String(x):""},jc.vault={commit:()=>{if(AS.test.str(jc.vault.storageKey)||jc.vault.init(),AS.test.def(window.Storage)){let stor={};Object.keys(jc.vault.prop).forEach(key=>{key.match(/^global::/)?localStorage.setItem(key,JSON.stringify(jc.vault.prop[key])):stor[key]=jc.vault.prop[key]}),AS.test.str(jc.vault.storageKey)&&localStorage.setItem(jc.vault.storageKey,JSON.stringify(stor))}},key:(ctx,k,v)=>(AS.test.str(jc.vault.storageKey)||jc.vault.init(),!(!AS.test.str(ctx)||""===ctx)&&(jc.vault.prop[ctx]=AS.def.obj(jc.vault.prop[ctx]),AS.test.str(k)&&""!==k?(AS.test.def(v)&&(AS.test.date(v)&&(v=v.tosql()),jc.vault.prop[ctx][k]=v,jc.vault.commit()),"object "==typeof jc.vault.prop[ctx][k]?JSON.parse(JSON.stringify(jc.vault.prop[ctx][k])):jc.vault.prop[ctx][k]):JSON.parse(JSON.stringify(jc.vault.prop[ctx])))),list:ctx=>{AS.test.str(jc.vault.storageKey)||jc.vault.init();let ans=[];return AS.test.str(ctx)&&""!==ctx?AS.test.obj(jc.vault.prop[ctx])&&Object.keys(jc.vault.prop[ctx]).forEach(i=>{ans.push(i)}):Object.keys(jc.vault.prop).forEach(i=>{ans.push(i)}),ans},load:(ctx,hash)=>{AS.test.str(jc.vault.storageKey)||jc.vault.init(),AS.test.str(ctx)&&""!==ctx&&AS.test.obj(hash)&&(jc.vault.prop[ctx]=hash,jc.vault.commit())},init:()=>{var s;jc.vault.storageKey="jc::vault::user",AS.test.def(window.Storage)?(s=window.localStorage.getItem(jc.vault.storageKey),jc.vault.prop=AS.test.str(s)?JSON.parse(s):{},Object.keys(window.localStorage).filter(k=>0==k.indexOf("global::")).forEach(key=>{var s=window.localStorage.getItem(key);jc.vault.prop[key]=AS.test.str(s)?JSON.parse(s):{}})):jc.vault.prop={}},purge:(ctx,k)=>{AS.test.str(ctx)&&""!==ctx?AS.test.str(k)&&""!==k?jc.vault.prop[ctx][k]=void 0:(jc.vault.prop[ctx]=void 0,0==ctx.indexOf("global::")&&window.localStorage&&window.localStorage.removeItem(ctx)):(Object.keys(jc.vault.prop).filter(k=>0==k.indexOf("global::")).forEach(k=>{window.localStorage.removeItem(k)}),jc.vault.prop={}),jc.vault.commit()}},jc.prefs={init:()=>(jc.vault.key("jc::prefs","prefsVersion")?jc.prop.prefs.prefsVersion>parseInt(jc.vault.key("jc::prefs","prefsVersion"))?(jc.vault.purge("jc::prefs"),jc.prefs.commit()):jc.prefs.load(jc.vault.key("jc::prefs")):jc.prefs.commit(),jc.prefs),serialize:()=>JSON.stringify(jc.prop.prefs),dump:()=>JSON.parse(jc.prefs.serialize()),load:o=>!(jc.prop.prefs.prefsVersion>parseInt(o.prefsVersion))&&(jc.prop.prefs=JSON.parse(JSON.stringify(o)),jc.prefs.commit(),2<jc.prefs.debugLevel()&&jc.prefs.debugLevel(2),!0),key:(k,v)=>(AS.test.def(v)&&(AS.test.date(v)&&(v=v.tosql()),jc.prop.prefs[k]=v,jc.prefs.commit()),jc.prop.prefs[k]),purge:k=>{delete jc.prop.prefs[k],jc.vault.purge("jc::prefs",k)},commit:()=>{Object.keys(jc.prop.prefs).forEach(k=>{jc.vault.key("jc::prefs",k,jc.prop.prefs[k]),jc.prop[k]=jc.prop.prefs[k]})},debugLevel:x=>{if(AS.test.def(x)&&(AS.test.str(x)&&(x=parseInt(x)),AS.test.num(x)))if(jc.prefs.key("debugLevel",x),0<x)jc.console("Debug Level: "+x);else try{console.log.call(this,"Debug is OFF")}catch(x){}return jc.prefs.key("debugLevel")}},jc.console=(...args)=>{var dl=jc.prefs.debugLevel();if(2<dl)jc.debug.apply(window,args);else if(0<dl)try{console.log.apply(window,args)}catch(e){}},jc.args2array=args=>Array.prototype.slice.call(args),jc.debug=(...args)=>{AS.test.udef(jc.prop._debug)&&(jc.prop._debug={timeout:!1,queue:[],todate:!1}),0<args.length&&(jc.prop._debug.queue=jc.prop._debug.queue.concat(args)),jc.prop._debug.todate?5e3<new Date-jc.prop._debug.todate&&0<jc.prop._debug.queue.length&&(console.log("Debugging: ",args),delete jc.prop._debug):0<jc.prop._debug.queue.length?(jc.prop._debug.timeout=window.setTimeout(jc.debug,5500),jc.prop._debug.todate=new Date):jc.prop._debug.timeout&&(window.clearTimeout(jc.prop._debug.timeout),delete jc.prop._debug)},jc.debugLevel=x=>{if(AS.test.def(x)&&(AS.test.str(x)&&(x=parseInt(x)),AS.test.num(x)))if(jc.prop.prefs.debugLevel=x,jc.vault.load("jc::prefs",jc.prop.prefs),0<x)jc.console("Debug Level: "+x);else try{console.log.call(window,"Debug is OFF")}catch(x){}return jc.prop.prefs.debugLevel},jc.debugURI=x=>(AS.test.def(x)&&(AS.test.str(x)&&(x=parseInt(x)),AS.test.num(x)&&(x=0!=x),AS.test.bool(x)&&(jc.prop.prefs.debugURI=x,jc.vault.load("jc::prefs",jc.prop.prefs))),jc.prop.prefs.debugURI),jc.template={prop:{info:{},html:{},part:{},repo:{}},info:{get:(template,callback)=>{var url=jc.template.prop.info[template];if(url)if("_loading_"==url)setTimeout(()=>{jc.template.info.get(template,callback)},100);else{if(!AS.test.func(callback))return url;callback.call(window,url)}else{url=AS.path("jstemplates")+"info/"+template+(jc.prop.isDeveloper?"":".min")+".js";jc.console("jc.template.info.get :",url),jc.template.prop.info[template]="_loading_",jc.springLoadJs(url),setTimeout(()=>{jc.template.info.get(template,callback)},100)}},set:(template,obj)=>{obj.html||(obj.html="index"),jc.template.prop.info[template]=obj}},html:{get:(key,callback)=>{var url=jc.template.prop.html[key];if(url)if("_loading_"==url)setTimeout(()=>{jc.template.html.get(key,callback)},100);else{if(!AS.test.func(callback))return url;callback.call(window,url)}else{url=AS.path("jstemplates")+"html/"+key+".html";jc.template.html.set(key,"_loading_"),jc.dav.get(url,h=>{jc.template.html.set(key,h),jc.template.html.get(key,callback)},jc.getError)}},set:(key,value)=>{jc.template.prop.html[key]=value},current:key=>(AS.test.str(key)&&(jc.template.prop.currentInfo=key),jc.template.prop.currentInfo)},part:{get:(key,...args)=>{let callback,options={};args.forEach(a=>{AS.test.func(a)?callback=a:AS.test.obj(a)&&(options=a)});let v=jc.template.prop.part[key];if(!v)return jc.template.part.set(key,"_loading_"),void(key.match(/\.json$/)?jc.jdav.get("parts/"+key,j=>{jc.template.part.set(key,j),jc.template.part.get(key,callback,options)},()=>{jc.template.part.set(key,{type:key.replace(/\.json$/,"")}),jc.template.part.get(key,callback,options)}):key.match(/\.x?html?$/)&&jc.dav.get("parts/"+key,j=>{jc.template.part.set(key,j),jc.template.part.get(key,callback,options)},jc.getError));if("_loading_"!=v){if(!AS.test.obj(v)||!v.type||options.raw)return AS.test.func(callback)?void callback.call(window,v):v;jc.template.repo.get("part-"+v.type,repo=>{v=options.repo?repo:repo.render(v),AS.test.func(callback)&&callback.call(window,v)})}else setTimeout(()=>{jc.template.part.get(key,callback,options)},100)},reload:(key,...args)=>{let callback,options={};return args.forEach(a=>{AS.test.func(a)?callback=a:AS.test.obj(a)&&(options=a)}),delete jc.template.prop.part[key],jc.template.part.get(key,callback,options)},put:(key,data,callback)=>{AS.test.obj(data)?jc.jdav.put("parts/"+key,data,()=>{jc.template.part.reload(key,{raw:!0},callback)},jc.getError):jc.dav.put("parts/"+key,data,()=>{jc.template.part.reload(key,callback)},jc.getError)},set:(key,value)=>{jc.template.prop.part[key]=value}},repo:{get:(repo,callback)=>{let data=jc.template.prop.repo[repo];if(data||(data="_loading_",jc.springLoad(AS.path("jsreporoot")+repo+(jc.prop.isDeveloper?"":".min")+".js")),"_loading_"!=data)return AS.test.func(callback)&&callback.call(window,data),data;window.setTimeout(()=>{jc.template.repo.get(repo,callback)},100)},set:(repo,data)=>{jc.template.prop.repo[repo]=data}}},jc.lists={prop:{lists:{},lasts:{},tags:{}},list:{uri:type=>"struct/"+type+"-list.json",get:(...args)=>{const type=args.find(a=>AS.test.str(a))||"_all",callback=args.find(a=>AS.test.func(a));var list=jc.lists.prop.lists[type];if("_loading_"!=list)return AS.test.obj(list)?AS.test.func(callback)?void callback.call(window,JSON.parse(JSON.stringify(list))):JSON.parse(JSON.stringify(list)):(jc.lists.prop.lists[type]="_loading_",void jc.jdav.get(jc.lists.list.uri(type),l=>{"_loading_"==jc.lists.prop.lists[type]&&(jc.lists.prop.lists[type]=l||{}),jc.lists.list.get.apply(window,args)}));window.setTimeout(()=>{jc.lists.list.get.apply(window,args)},100)},fetch:(...args)=>{var type=args.find(a=>AS.test.str(a))||"_all";delete jc.lists.prop.lists[type],jc.lists.list.get.apply(window,args)}},last:{uri:(type,qt)=>"struct/"+type+"-last"+qt+".json",get:(...args)=>{const type=args.find(a=>AS.test.str(a))||"_all",qt=args.find(a=>AS.test.num(a)),callback=args.find(a=>AS.test.func(a));jc.lists.prop.lasts[type]||(jc.lists.prop.lasts[type]={});var list=jc.lists.prop.lasts[type][String(qt)];if("_loading_"!=list)return AS.test.arr(list)?AS.test.func(callback)?void callback.call(window,JSON.parse(JSON.stringify(list))):JSON.parse(JSON.stringify(list)):(jc.lists.prop.lasts[type][String(qt)]="_loading_",void jc.jdav.get(jc.lists.last.uri(type,qt),l=>{"_loading_"==jc.lists.prop.lasts[type][String(qt)]&&(jc.lists.prop.lasts[type][String(qt)]=l||[]),jc.lists.last.get.apply(window,args)}));window.setTimeout(()=>{jc.lists.last.get.apply(window,args)},100)},fetch:(...args)=>{var type=args.find(a=>AS.test.str(a))||"_all",qt=args.find(a=>AS.test.num(a));jc.lists.prop.lasts[type]||(jc.lists.prop.lasts[type]={}),delete jc.lists.prop.lasts[type][String(qt)],jc.lists.last.get.apply(window,args)}},tag:{uri:type=>"struct/tag-"+type+".json",get:(...args)=>{const type=args.find(a=>AS.test.str(a))||"site",callback=args.find(a=>AS.test.func(a));if("_loading_"!=jc.lists.prop.tags[type])return jc.lists.prop.tags[type]?AS.test.func(callback)?void callback.call(window,JSON.parse(JSON.stringify(jc.lists.prop.tags[type]))):JSON.parse(JSON.stringify(jc.lists.prop.tags[type])):(jc.lists.prop.tags[type]="_loading_",void jc.jdav.get(jc.lists.tag.uri(type),l=>{"_loading_"==jc.lists.prop.tags[type]&&(jc.lists.prop.tags[type]=l||{}),jc.lists.tag.get.apply(window,args)}));window.setTimeout(()=>{jc.lists.tag.get.apply(window,args)},100)},fetch:(...args)=>{var type=args.find(a=>AS.test.str(a))||"site";delete jc.lists.prop.tags[type],jc.lists.tags.get.apply(window,args)}}},jc.page={prop:{renderers:{},templateInfo:{},templateHtml:{},parts:{},currentTemplateHtml:"",current:!1,changed:!1},changed:s=>{if(AS.test.def(s)&&(jc.page.prop.changed=!!s,AS.test.obj(tp)&&AS.test.func(tp.formChanged)))try{tp.formChanged.call(window,jc.page.prop.changed)}catch(e){}return jc.page.prop.changed},current:s=>(AS.test.def(s)&&(jc.page.prop.current=s),jc.page.prop.current),addData:d=>{let od=jc.def.obj(jc.page.data());return AS.test.obj(d)&&Object.keys(d).forEach(k=>{od[k]=d[k]}),jc.page.data(od)},data:d=>(AS.test.obj(d)&&(jc.page.prop.data=d),jc.page.prop.data),open:(page,id,data,infokey)=>{if(!AS&&AS.labels&&AS.labels.loaded)return setTimeout(()=>{jc.page.open(page,id,data,infokey)},100);if((page=page||"index")==jc.page.current())if(id){if(jc.page.data()&&jc.page.data().id&&id==jc.page.data().id)return}else if(!jc.page.data()||!jc.page.data().id)return;if(jc.edit&&jc.edit.data()&&jc.edit.data(!1),$(document.body).trigger("jc_page_open_requested",{page:page,id:id,uriparams:data}),AS.test.udef(data)?data={}:AS.test.str(data)&&(data=$.parseParams(data)),data&&AS.test.str(data.template)&&(infokey=infokey||String(data.template),delete data.template),data){let args={};Object.keys(AS.def.obj(data)).filter(k=>AS.test.str(data[k])).filter(k=>0!=k.indexOf("_")).forEach(k=>{args[k]=String(data[k]),delete data[k]}),data.args=args}infokey=(infokey=!infokey&&data&&AS.test.obj(data.template)?data.template.key:infokey)||page,jc.page.changed(!1),jc.console("Opening page:"+page,id,data,infokey),jc.page.data(data),$(document.body).on("jc_render_end",jc.page.finalize),jc.page.step.info(page,id,data,infokey)},loadData:(page,url,callback)=>{"page"==jc.page.prop.editMode&&jc.edit&&jc.edit.data()?AS.test.func(callback)&&callback.call(window,jc.edit.data()):(url=AS.path("jsdatapages")+page+(url||"")+".json",jc.jdav.get(url,data=>{AS.test.func(callback)&&callback.call(window,data)}))},reload:()=>{$(window).scrollTop();$(document.body).on("jc_render_end",jc.page.finalize),jc.page.step.data(jc.page.current(),jc.page.data().id)},finalize:()=>{$(document.body).off("jc_render_end",jc.page.finalize);const closure=()=>{jc.page.prop.editMode||window.scrollTo(0,0),setTimeout(()=>{var d=jc.page.data();$(document.body).trigger("jc_page_open_completed",{page:jc.page.current(),id:d.id,uriparams:d.args})},100)};let tbf=[];$('a[href*="/!"]').each((idx,a)=>{a.getAttribute("href").match(/^(\.\.\/)*(\.\.)?\/!([a-z]+)([0-9]*)/)&&tbf.push(a)}),tbf.length?jc.lists.list.get(l=>{tbf.forEach(a=>{let h=a.getAttribute("href").replace(/^(\.\.\/)*(\.\.)?\/!([a-z]+)([0-9]*).*$/,"$3$4");var pt=h.replace(/[^a-z]/g,""),id=h.replace(/[^0-9]/g,"")||void 0;a.setAttribute("href",`javascript:jc.page.open('${pt}'${id?","+id:""})`),a.innerHTML.match(/^!+/)&&l[pt]&&l[pt][id||"0"]&&(a.innerHTML=l[pt][id||"0"].title||AS.label("Unknown"))}),closure()}):closure()},step:{info:(page,id,data,infokey)=>{jc.template.info.get(infokey,tdata=>{$(document.body).trigger("jc_page_template_info_loaded",tdata),(data=data||{}).template||(data.template=tdata),jc.page.step.html(page,id,data)},()=>{jc.page.open("index")})},html:(page,id,data)=>{jc.page.current(page),AS.test.obj(data)&&jc.page.addData(data),jc.page.addData({id:id}),jc.template.html.get(data.template.html,html=>{data.template.html!=jc.template.html.current()&&(jc.template.html.current(data.template.html),$("#"+jc.prop.mainContainerId).html(html)),$(document.body).trigger("jc_page_template_html_loaded",html),jc.page.step.data(page,id)},()=>{jc.page.open("index")})},data:(page,id)=>{jc.page.loadData(page,id,j=>{var data=jc.page.data();if(!j){if(id||!data.template.service)return void jc.page.open("index");j={metadata:{type:page}}}if(window.tp={},jc.page.addData({pageContent:j}),jc.URI.push(),$("#jcHiddenPageIndicator").remove(),j.metadata){var h=document.documentElement.querySelector("head");const md=j.metadata;md.title&&$("title",h).html(md.title);let keywords=(md.keywords||"").split(/, */),lang=!1,alltags=jc.objFindAll(j,"type","tags").filter(x=>x.tags&&x.tags.length);alltags&&alltags.length&&(alltags.filter(x=>x.show).forEach(tf=>{tf.tags.forEach(t=>{let tt=t.tag.toLowerCase();keywords.find(x=>x==tt)||keywords.push(tt)})}),alltags.filter(x=>x.name.match(/^lang/i)&&1==x.tags.length).forEach(tf=>{!lang&&tf.tags[0].tag.match(/^[a-z]{2}(_[A-Z]{2})?$/)&&(lang=tf.tags[0].tag)})),lang?($(document.documentElement).attr("lang",lang),keywords=keywords.filter(x=>x!=lang)):$(document.documentElement).removeAttr("lang"),keywords.length&&$('meta[name="keywords"]',h).attr("content",keywords.join(", ")),md.description&&$('meta[name="description"]',h).attr("content",md.description),md.hidden&&$(document.body).append(`<div id="jcHiddenPageIndicator"><span>${AS.label("PageHidden")}</span></div>`),$(document.body).attr("style","")}$(document.body).trigger("jc_page_data_loaded",j),"page"==jc.page.prop.editMode&&jc.edit.data(j),data.template.content&&jc.render.init(data.template.content)})}},checkJcMenu:ctx=>{AS.test.udef(ctx)&&(ctx=document.body);let $menu=$(".jcMenu:not(.jcMenuParsed)",ctx);$menu.length&&($menu.html(""),$menu.addClass("jcMenuParsed"),jc.prop.authUser||AS.getCookie("jcAuthUser")?(jc.prop.isLoggedIn=!0,jc.springLoad("module:edit"),$(document.body).addClass("jcUserAuth"),$menu.hasClass("jcMenuText")?$menu.append(`<span class="jcicon">${AS.icon("user")}</span>`):$menu.append(`<div class="jcicon jcAuth">${AS.icon("menu")}</div>`),$menu.on("click contextmenu",jc.actionsMenu),$(document.body).on("contextmenu",jc.actionsMenu)):($(document.body).removeClass("jcUserAuth"),$menu.hasClass("jcMenuText"),$menu.append(`<span class="jcicon jcUnauth">${AS.icon("lock")}</span>`),$menu.off("click contextmenu",jc.actionsMenu),$(document.body).off("contextmenu",jc.actionsMenu),$(".jcUnauth",$menu).on("click",jc.page.login)))},login:()=>{let sp=(new Date).getTime();jc.login((d,ep)=>{ep||($(".jcMenu").removeClass("jcMenuParsed"),jc.page.checkJcMenu(),ep=(new Date).getTime(),jc.springLoad("module:edit"),2e3<ep-sp&&Swal.fire({title:AS.label("LoginDoneTitle"),text:AS.label("LoginDoneBody",{user:jc.prop.authUser}),icon:"success"}))})},edit:(status,savePolicy)=>{if(!jc.edit)return jc.springLoad("module:edit"),window.setTimeout(()=>{jc.page.edit(status,savePolicy)},300);if("maintenance"!=status){if("page"==status){jc.page.prop.editMode=status;let oe=jc.edit.data()||!1;return oe?void Swal.fire({title:AS.label("editYetItTitle"),text:AS.label("editYetItBody"),icon:"warning",showDenyButton:!0,showCancelButton:!0,cancelButtonText:AS.label("Cancel"),confirmButtonText:AS.label("editYetItOk"),denyButtonText:AS.label("editYetItCancel")}).then(result=>{result.isConfirmed?(jc.edit.data(oe),jc.page.reload()):result.isDenied?(jc.edit.data(jc.page.data().pageContent),jc.page.reload()):jc.page.prop.editMode=!1}):(jc.edit.data(jc.page.data().pageContent),void jc.page.reload())}if("parts"==status)return jc.page.prop.editMode=status,void jc.page.reload();if(AS.test.udef(savePolicy))Swal.fire({title:AS.label("SaveChangesTitle"),text:AS.label("SaveChangesBody"),icon:"question",showCancelButton:!0,showDenyButton:!0,denyButtonText:AS.label("menuEditOverDiscard"),confirmButtonText:AS.label("menuEditOverSave"),cancelButtonText:AS.label("Cancel"),hideClass:{popup:""}}).then(result=>{result.isConfirmed?jc.page.edit(status,!0):result.isDenied&&jc.page.edit(status,!1)});else{if("page"==jc.page.prop.editMode){var oe=jc.edit&&jc.edit.data()||!1;if(oe&&savePolicy)return void jc.page.save({data:oe,callback:()=>{jc.page.edit(status,!1)}});jc.edit.data(!1)}jc.page.prop.editMode=status,jc.page.reload()}}else jc.edit.maintenance()}},jc.render={prop:{},init:(...args)=>{delete jc.render.prop.pending,$(document.body).trigger("jc_render_start"),jc.console("Rendering is starting"),jc.render.main.apply(window,args)},queue:delta=>(AS.test.num(delta)&&(AS.test.udef(jc.render.prop.pending)&&(jc.render.prop.pending=0),jc.render.prop.pending+=delta,0==jc.render.prop.pending&&(jc.render.prop.overtimeout&&window.clearTimeout(jc.render.prop.overtimeout),jc.render.prop.overtimeout=setTimeout(()=>{delete jc.render.prop.overtimeout,delete jc.render.prop.pending,$(document.body).trigger("jc_render_end"),jc.console("Rendering is over")},100))),jc.render.prop.pending),main:(data,pdata)=>{Array.isArray(data)||(data=[data]);let pfull=jc.page.data();AS.test.udef(pdata)&&(pdata=AS.test.obj(pfull)?pfull.pageContent:{}),data.forEach(e=>{let sel=(e=e.internalRecursion?{dontEmpty:!0,selector:e.selector,content:Array.isArray(e)?e:[e]}:e).selector||"#"+jc.prop.mainContainerId,$tgt=$(sel);if(e.dontEmpty||$tgt.html(""),e.part&&(e.content={type:"part",content:e.part},delete e.part),AS.test.def(e.content)&&!e.content)return $tgt.html(""),void(e.hidden=!0);AS.test.udef(e.editable)&&(e.editable=!0),e.content&&(Array.isArray(e.content)||(e.content=[e.content]),e.content.forEach(c=>{jc.render.prepare(c,pdata),AS.test.str(c)&&(c={rendered:AS.labels.labelize(c)}),AS.test.obj(c)&&(c.id||(c.id=AS.generateId("jc-block-"),$tgt.append('<hr style="display:none;" id="'+c.id+'" />'),$("#"+c.id,$tgt).data(c),jc.render.queue(1)),AS.test.udef(c.editable)&&(c.editable=e.editable),c.rendered?(jc.page.prop.editMode&&jc.render.editable(c),$("#"+c.id,$tgt).after("\x3c!--type:"+c.type+("part"==c.type?"="+c.content:"")+"--\x3e",c.rendered,"\x3c!--/type:"+c.type+"--\x3e").remove(),delete c.rendered,delete c.internalRecursion,delete c.id,AS.test.func(c.callback)&&c.callback.call(window,c),delete c.callback,jc.render.queue(-1)):c.type&&(c.internalRecursion=!0,c.selector=sel,jc.render[c.type]&&jc.render[c.type].call(window,c,pdata,pfull)))})),$(()=>{jc.page.checkJcMenu($tgt),$tgt.toggle(!e.hidden),jc.page.prop.editMode&&jc.edit&&jc.edit.start(),document.body.style.overflow="auto"})})},prepare:(c,pdata,$scope)=>{var ev;(AS.test.str(c)||AS.test.func(c))&&(c=(ev=jc.evalFunc(c))?{type:"func",func:ev}:{rendered:c}),AS.test.obj(c)&&(c.type||(c.blocks?c.type="blocks":c.render&&(c.type="customJs")),c.func&&!c.rendered&&(c.rendered=c.func.call(window,pdata)))},editable:c=>{if(jc.page.prop.editMode&&c.rendered&&c.editable&&AS.test.obj(c.editable)){let w=!0;c.rendered instanceof jQuery||c.rendered instanceof NodeList||c.rendered instanceof Node?w=!$(".jcEditable",c.rendered).length:AS.test.str(c.rendered)&&(w=c.rendered.indexOf('<div class="jcEditable">')<0),w&&(c.rendered=$('<div class="jcEditable"></div>').data("editable",c.editable).append(c.rendered))}return c},customJs:o=>{if(!jc.page.prop.renderers[o.render]){let url=AS.path("jsrenderers")+o.render+".js";return jc.console("Loading external renderer:",url),void $.ajax(url,{method:"GET",dataType:"text",error:jc.getError,success:t=>{let e;try{let f=eval(t);t=f}catch(e){jc.console("Error evaluating external JS render",url,o,e)}AS.test.func(t)?(jc.page.prop.renderers[o.render]=t,jc.render.customJs(o)):jc.console("External JS render not a function",url,o,t)}})}o.func=jc.page.prop.renderers[o.render],jc.render.main(o)},part:(o,pdata,pfull,other)=>{if(AS.test.udef(other)&&(jc.render.queue(1),other={}),other.content){if("parts"==jc.page.prop.editMode){if(!other.raw)return void jc.template.part.get(o.content,{raw:!0},raw=>{other.raw=raw,jc.render.part(o,pdata,pfull,other)});o.editable&&(o.editable={type:"part",src:o.content,raw:other.raw})}else o.editable&&(o.editable=!0);jc.render.main(o),jc.render.queue(-1)}else jc.template.part.get(o.content,partcontent=>{other.content=o.rendered=partcontent,AS.test.str(o.rendered)&&AS&&AS.labels&&(o.rendered=AS.labels.labelize(o.rendered)),jc.render.part(o,pdata,pfull,other)})},blocks:(o,pdata,pfull)=>{Array.isArray(o.blocks)||(o.blocks=[o.blocks]);let canedit=o.editable;o.rendered=o.blocks.map((b,idx)=>{AS.test.udef(b.editable)&&(b.editable=canedit);var editable=canedit&&!(AS.test.def(b.editable)&&!b.editable);let out=jc.render.block[b.type]?jc.render.block[b.type].call(window,b,pdata,o):"";if(canedit&&editable&&"page"==jc.page.prop.editMode){let w=!0;out instanceof jQuery||out instanceof NodeList||out instanceof Node?w=!$(".jcEditable",out).length:AS.test.str(out)&&(w=out.indexOf('<div class="jcEditable">')<0),out=w?(editable={prop:b.prop,type:"block",subtype:b.type},(AS.test.udef(out)||AS.test.str(out)&&0==out.length)&&(out='<span class="jcPlaceHolder">'+b.prop+"</span>"),$('<div class="jcEditable"></div>').data("editable",editable).append(out)):$('<div class="jcEditableBlock"></div>').append(out)}return out}),jc.render.main(o,pdata)},block:{text:(b,d)=>{let ct;if(AS.test.def(d[b.prop])&&AS.test.str(d[b.prop])&&d[b.prop].length?ct=d[b.prop]:b.content&&AS.test.str(b.content)&&b.content.length&&(ct=b.content),ct)return $(b.wrap||d.wrap||"<div></div>").append(ct)},html:(b,d)=>{if(!(AS.test.udef(d[b.prop])||AS.test.str(d[b.prop])&&0==d[b.prop].length))return'<div class="jcHtml">'+d[b.prop]+"</div>"},date:(b,d)=>{if(!(AS.test.udef(d[b.prop])||AS.test.str(d[b.prop])&&0==d[b.prop].length)){let $out=$(b.wrap||"<div></div>");return $out.addClass("jcDate"),$out.append('<span class="date">'+jc.sql2date(d[b.prop]).toblogdate()+"</span>"),"blogdate"==b.prop&&d.metadata&&d.metadata.type&&(jc.render.queue(1),jc.lists.list.get(d.metadata.type,ld=>{let sl=[];Object.keys(ld).forEach(k=>{sl.push(ld[k])}),sl.sort((a,b)=>a.date<b.date?1:-1);let prev,next,max=sl.length-1;for(let i=0;i<=max;i++)if(sl[i].id==d.metadata.id){0<i&&(prev=sl[i-1]),i<max&&(next=sl[i+1]);break}prev=prev?`onclick="jc.page.open('${d.metadata.type}',${prev.id})" title="${jc.sql2date(prev.date).toblogdate()}"`:'disabled="disabled"',next=next?`onclick="jc.page.open('${d.metadata.type}',${next.id})" title="${jc.sql2date(next.date).toblogdate()}"`:'disabled="disabled"';let idxpage=$(`<button type="button" class="btn btn-secondary btn-sm">${AS.icon("list")}</button>`);$out.append($('<span class="btn-group ml-2 mb-1"></span>').append(`<button type="button" class="btn btn-secondary btn-sm" ${prev}>${AS.icon("arrow-up")}</button>`).append(idxpage).append(`<button type="button" class="btn btn-secondary btn-sm" ${next}>${AS.icon("arrow-down")}</button>`));let finalize=()=>{$(document.body).off("jc_render_end",finalize);let pd=$(".jcNavbar .nav-item.active").data();pd&&pd.page?$(idxpage).on("click",()=>{jc.page.open(pd.page,pd.id)}):$(idxpage).on("click",()=>{jc.page.open("browsedates")})};$(document.body).on("jc_render_end",finalize),jc.render.queue(-1)})),$out}},mixed:(b,d)=>{if(!d[b.prop])return"";let out=$(b.wrap||'<div class="jcMixedBlocks"></div>');Array.isArray(d[b.prop])||(d[b.prop]=[d[b.prop]]);let qt=d[b.prop].length;return d[b.prop].forEach((sb,editable)=>{if(AS.test.str(sb)&&(sb={content:sb}),AS.test.obj(sb)&&(sb.type||(sb.type="text"),jc.render.block[sb.type])){let r=jc.render.block[sb.type].call(window,{prop:sb.type,editable:b.editable},sb,d)||"";if(b.editable&&"page"==jc.page.prop.editMode){editable={prop:b.prop,type:"block",subtype:sb.type,_:{idx:editable,qt:qt}};if(AS.test.udef(r)||AS.test.str(r)&&0==r.length){let lab="Block: "+sb.type+" "+(sb.label||sb.name||"");"tags"==sb.type&&(lab="Tags: "+(AS.def.obj(jc.prop.site.tags.find(x=>x.name==sb.name)).label||"Unknown")),r='<span class="jcPlaceHolder">'+lab+"</span>"}r=$('<div class="jcEditable"></div>').data("editable",editable).append(r)}out.append(r)}}),out},part:(b,d)=>{var id=AS.generateId("blockPart");let div=$("<div></div>");div.attr("id",id);let nb={selector:"#"+id,type:"part",content:b.content||d[b.prop],internalRecursion:!0,callback:()=>{div.removeAttr("id")}};return window.setTimeout(()=>{jc.render.main(nb,d)},10),div},gallery:(b,d,pdata)=>{if(!AS.test.arr(d[b.prop])||!d[b.prop].length)return"";let gid=AS.generateId("jcGallery"),$div=$("<div></div>");if(d.size&&d.size.length&&$div.addClass("size"+d.size),"C"==d.aspect){$div.addClass("jcCarousel carousel slide"),$div.attr({id:gid,"data-interval":2e4});let imgs=[];if(d[b.prop].forEach(uu=>{var u=pdata.uploads.find(x=>x.uri==uu.uri);u&&u.img&&imgs.push(u)}),d.flags&&d.flags.includes("i")){let $ol=$('<ol class="carousel-indicators"></ol>');imgs.forEach((i,idx)=>{$ol.append(`<li data-target="#${gid}" data-slide-to="${idx}" class="${idx?"":"active"}"></li>`)}),$div.append($ol)}let $in=$('<div class="carousel-inner"></div>');imgs.forEach((i,idx)=>{let $it=$('<div class="carousel-item"></div>');idx||$it.addClass("active"),$it.append(` <img src="${i.uri}" alt="${i.caption}" oncontextmenu="event.stopPropagation();" />`),d.flags&&d.flags.includes("c")&&$it.append($('<div class="carousel-caption d-none d-md-block"></div>').append("<h5></h5>").html(i.caption)),$in.append($it)}),$div.append($in),d.flags&&d.flags.includes("x")&&$div.append($(`<a class="carousel-control-prev" href="#${gid}" role="button" data-slide="prev"></a>`).append('<span class="carousel-control-prev-icon" aria-hidden="true"></span>','<span class="sr-only">Previous</span>'),$(`<a class="carousel-control-next" href="#${gid}" role="button" data-slide="next"></a>`).append('<span class="carousel-control-next-icon" aria-hidden="true"></span>','<span class="sr-only">Next</span>'))}else{if($div.addClass("jcGallery"),"I"===d.aspect?$div.addClass("inline"):$div.addClass("thumbs"),d.pos)switch(d.pos){case"left":$div.addClass("jcBoxFloatImg jcBoxLeft");break;case"right":$div.addClass("jcBoxFloatImg jcBoxRight")}d[b.prop].forEach(uu=>{let u=pdata.uploads.find(x=>x.uri==uu.uri);if(u){let $a=$(`<a href="${u.uri}"></a>`);u.fb&&($a.attr("data-fancybox",gid),$a.attr("data-caption",u.caption)),$a.attr("title",u.caption),u.img?$a.append(`<img src="${u.uri}" alt="${u.caption}" />`):(u.fb?u.au||u.vid?($a.append(AS.icon(u.au?"audio":"video")),$a.attr("data-type","iframe"),$a.attr("data-src",u.uri),$a.attr("data-download",u.name),$a.attr("href","javascript:;")):$a.append(AS.icon("file")):($a.attr("download",u.name),$a.append(AS.icon("downloadPublic"))),u.ext&&u.ext.length&&($a.attr("title",u.caption+" ("+u.ext.toUpperCase()+")"),$a.append("<span>."+u.ext.shorten(5)+"</span>"))),$div.append($a)}})}return $div},lasts:(b,d)=>{var qt=AS.generateId("lasts");let nodes=(d.view||"ol,li").split(","),div=$('<div class="jcLasts jcEntriesArea"></div>');div.attr("id",qt);qt=jc.prop.lastChangedQuantities.clone().sort((a,b)=>a-b).find(x=>d.max<=x);return jc.lists.last.get(d.ptype,qt,list=>{if(AS.test.arr(list)&&list.length){d.title&&div.append($("<h5></h5>").append(d.title));let $ol=$("<"+nodes[0]+' class="jcLastsEntries jcEntries"></'+nodes[0]+">");list.splice(d.max);let cp=jc.page.current(),cid=jc.page.data().id;list.forEach(i=>{let p=i.type||d.ptype,$li=$("<"+nodes[1]+' class="jcLastsEntry jcEntry"></'+nodes[1]+">"),$a;if($a=cp==p&&i.id==cid?($li.append("➤ "),$('<span class="title"></span>').html(i.title)):$(`<a class="title" href="${jc.URI.encode({page:p,id:i.id},i.url)}"></a>`).on("click",e=>{e.preventDefault(),jc.page.open(p,i.id)}).html(i.title),$li.append($a),d.showdate){let dt=new Date(i.upd);$li.append(" ",$('<span class="date"></span>').html(dt.toLocaleDateString())),d.showtime&&$li.append($('<span class="time"></span>').html(dt.toLocaleTimeString()))}d.showdesc&&i.description&&i.description.length&&$li.append("<br />",$('<small class="desc"></small>').html(i.description)),$ol.append($li)}),div.append($ol)}}),div},relateds:(b,d)=>{var id=AS.generateId("relateds");let nodes=(d.view||"ol,li").split(","),$div=$('<div class="jcRelateds jcEntriesArea"></div>');return $div.attr("id",id),d.position&&$div.addClass(d.position),d.title&&$div.append($("<h5></h5>").append(d.title)),jc.render.queue(1),jc.lists.list.get(data=>{let $ol=$("<"+nodes[0]+' class="jcRelatedEntries jcEntries"></'+nodes[0]+">");d.relateds.forEach(i=>{var $a=!!data[i.item.page]&&data[i.item.page][String(i.item.id||0)];if($a){let $li=$("<"+nodes[1]+' class="jcRelatedEntry jcEntry"></'+nodes[1]+">");$a=$(`<a class="title" href="${jc.URI.encode(i.item,$a.url)}"></a>`).on("click",e=>{e.preventDefault(),jc.page.open(i.item.page,i.item.id)}).html($a.title);$li.append($a),$ol.append($li)}}),$div.append($ol),jc.render.queue(-1)}),$div},pbytag:(b,d)=>{var id=AS.generateId("pbytag");let $div=$('<div class="jcPbytgag jcEntriesArea"></div>');$div.attr("id",id);let tobegrabbedtags=d.rules.map(x=>x.tf),tf={};const process=()=>{if(tobegrabbedtags.length){let tfn=tobegrabbedtags.shift();jc.lists.tag.get(tfn,l=>{tf[tfn]=l,process()})}else{let list=!1;if(d.rules.forEach(r=>{let rlists=r.tv.map(tag=>tf[r.tf][tag.tv]),rlist=!1;rlists.forEach(l=>{rlist?"or"==r.op?l.forEach(li=>{rlist.find(x=>x.type==li.type&&x.id==li.id)||rlist.push(li)}):rlist=rlist.filter(x=>l.find(li=>x.type==li.type&&x.id==li.id)):rlist=l}),list?"or"==d.op?rlist.forEach(li=>{list.find(x=>x.type==li.type&&x.id==li.id)||list.push(li)}):list=list.filter(x=>rlist.find(li=>x.type==li.type&&x.id==li.id)):list=rlist}),list&&list.length){let pt=jc.page.current(),id=jc.page.data().id;list=list.filter(x=>!(x.hidden||x.type==pt&&x.id==id))}if(list&&list.length){d.title&&$div.append($("<h5></h5>").append(d.title)),d.position&&$div.addClass(d.position);let nodes=(d.view||"ul,li").split(","),$ol=$("<"+nodes[0]+' class="jcPbytgagEntries jcEntries"></'+nodes[0]+">");list.sort((a,b)=>(a,b)=>a.title.toLowerCase()>b.title.toLowerCase()?1:-1).forEach(i=>{if(i&&i.type){let $li=$("<"+nodes[1]+' class="jcPbytgagEntry jcEntry"></'+nodes[1]+">");var $a=$(`<a class="title" href="${jc.URI.encode(i)}"></a>`).on("click",e=>{e.preventDefault(),jc.page.open(i.type,i.id)}).html(i.title);$li.append($a),$ol.append($li)}}),$div.append($ol)}jc.render.queue(-1)}};return jc.render.queue(1),setTimeout(process,100),$div},subpage:(b,d)=>{let id=AS.generateId("blockSubpage"),div=$("<div></div>");div.attr("id",id);let s=b.content||d[b.prop];return jc.render.queue(1),jc.template.info.get(s.page,tmpl=>{AS.test.arr(tmpl.content)||(tmpl.content=[tmpl.content]);let blocks=[];if(tmpl.content.forEach(c=>!!c.content&&(AS.test.arr(c.content)||(c.content=[c.content]),void c.content.forEach(cc=>{AS.test.arr(cc.blocks)&&cc.blocks.filter(x=>!("subpage"==x.type)).forEach(b=>{let nb=JSON.parse(JSON.stringify(b));nb.editable=!1,blocks.push(nb)})}))),!AS.test.arr(blocks)||!blocks.length)return jc.render.queue(-1);jc.jdav.get(AS.path("jsdatapages")+s.page+(s.id||"")+".json",pdata=>{if(!d.force&&pdata.metadata&&pdata.metadata.hidden)return jc.render.queue(-1);if(AS.test.udef(pdata.blocks)&&(pdata.blocks=[]),AS.test.arr(pdata.blocks)||(pdata.blocks=[pdata.blocks]),!pdata.blocks.length)return jc.render.queue(-1);var nb={selector:"#"+id,content:{type:"blocks",blocks:blocks},editable:!1,callback:()=>{}};jc.render.main(nb,pdata),jc.render.queue(-1)})}),div},audio:(b,d,pdata)=>{if(!AS.test.udef(d[b.prop])&&AS.test.obj(d[b.prop])&&d[b.prop].uri){let adata=pdata.uploads.find(x=>x.uri==d[b.prop].uri);if(adata){let $a=$(`<audio src="${adata.uri}" type="${adata.type}" download="${adata.name}" controls="controls">This browser doesn’t support HTML5 audio</audio>`),$d=$('<div class="jcAudio"></div>');return $a.on("error",()=>{$d.html('<div style="max-width:640px;" class="alert alert-warning" role="alert">'+AS.label("UnsupportedMedia",adata)+"</div>")}),$d.append($a),$d}}},video:(b,d,pdata)=>{if(!AS.test.udef(d[b.prop])&&AS.test.obj(d[b.prop])&&d[b.prop].uri){let vdata=pdata.uploads.find(x=>x.uri==d[b.prop].uri);if(vdata){let $v=$(`<video src="${vdata.uri}" type="${vdata.type}" download="${vdata.name}" controls="controls">This browser doesn’t support HTML5 video</video>`),$d=$('<div class="jcVideo"></div>');return $v.on("error",()=>{$d.html('<div style="max-width:640px;" class="alert alert-warning" role="alert">'+AS.label("UnsupportedMedia",vdata)+"</div>")}),$d.append($v),$d}}},youtube:(uri,d)=>{uri=(url=>{let ID;return url.includes("vimeo")&&url.match(/^.*\/([0-9]{8,}).*$/)?(ID=url.replace(/^.*\/([0-9]{8,}).*$/,"$1"),"https://player.vimeo.com/video/"+ID):(url=url.replace(/(>|<)/gi,"").split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/),ID=void 0!==url[2]?(ID=url[2].split(/[^0-9a-z_\-]/i),ID[0]):url,ID.includes("://")?ID:`https://www.youtube.com/embed/${ID}?rel=0`)})(d[uri.prop]);let $d=$('<div class="jcYoutube embed-responsive embed-responsive-16by9"></div>');return $d.append(`<iframe class="embed-responsive-item" src="${uri}" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>`),$d},tags:(b,d)=>{if(!(d.show&&AS.test.arr(d.tags)&&d.tags.length))return"";var id=AS.generateId("tags");let nodes=(d.view||"ul,li").split(","),$div=$('<div class="jcTags jcEntriesArea"></div>');$div.attr("id",id),d.position&&$div.addClass(d.position),jc.render.queue(1);const build=()=>{if(!jc.prop.site)return setTimeout(build,100);let tag=AS.def.arr(jc.prop.site.tags).find(x=>AS.test.obj(x)&&x.name&&x.name==d.name);var minimal="p"==nodes[0];if(!tag)return $div.remove(),void jc.render.queue(-1);let $ol=$("<"+nodes[0]+' class="jcTagEntries jcEntries"></'+nodes[0]+">");d.showtitle&&(minimal?($ol.addClass("compact"),$ol.append($("<i></i>").append((d.customtitle||tag.label||tag.name)+": "))):$div.append($("<h5></h5>").append(d.customtitle||tag.label||tag.name)));const useProps=!(minimal||!tag.props||!tag.props.length);d.tags.forEach(t=>{let $li=$("<"+nodes[1]+' class="jcTagEntry jcEntry"></'+nodes[1]+">"),$s=$(`<span class="title">${t.tag.escape()}</span>`);if($s.on("click",()=>{jc.page.open("browsetags",void 0,{f:d.name,t:t.tag})}),$li.append($s),useProps){let props=[];tag.props.forEach(p=>{t[p.name]&&props.push((d.verbose&&p.label?p.label+": ":"")+t[p.name])}),props.length&&$li.append(d.verbose?"<br />":" ",props.join(d.verbose?"<br />":", "))}$ol.append($li)}),$div.append($ol),jc.render.queue(-1)};return $(()=>{build()}),$div}}},jc.actionsMenu=e=>{let acts=[];if(e.stopPropagation(),"page"==jc.page.prop.editMode)acts.push(AS.label("ThisPage")+":",{icon:"jcicon",iconKey:"metadata",label:AS.label("Metadata"),action:()=>{jc.edit.meta.edit()}},{icon:"jcicon",iconKey:"pageEditOff",label:AS.label("menuEditOver")+":",action:()=>{jc.page.edit(!1)},content:[{icon:"jcicon",iconKey:"done",label:AS.label("menuEditOverSave"),action:()=>{jc.page.edit(!1,!0)}},{icon:"jcicon",iconKey:"editRemove",label:AS.label("menuEditOverDiscard"),action:()=>{jc.page.edit(!1,!1)}}]});else if("parts"==jc.page.prop.editMode)acts.push(AS.label("IncludedParts")+":",{icon:"jcicon",iconKey:"done",label:AS.label("menuEditOver"),action:()=>{jc.page.edit(!1,!1)}});else{let tp={label:AS.label("ThisPage")+":",content:[]},ws={label:AS.label("WholeSite")+":",content:[]};tp.content.push({icon:"jcicon",iconKey:"pageEdit",label:AS.label("menuEditStart"),action:()=>{jc.page.edit("page")}},{icon:"jcicon",iconKey:"uploads",label:AS.label("Attachments"),action:()=>{jc.edit.uploads.edit()}}),AS.test.def(jc.page.data().id)&&tp.content.push("-",{icon:"jcicon danger",iconKey:"pageRm",label:AS.label("DeleteThisPage")+"…",action:()=>{jc.page.rm()}}),ws.content.push({icon:"jcicon",iconKey:"pageAdd",label:AS.label("NewPage")+"…",action:()=>{jc.page.create()}},{icon:"jcicon",iconKey:"pageParts",label:AS.label("IncludedParts"),action:()=>{jc.page.edit("parts")}},"-",{icon:"jcicon",iconKey:"maintenance",label:AS.label("Maintenance"),action:()=>{jc.page.edit("maintenance")}}),acts.push(AS.label("menuActionsTitle"),tp,"-",ws)}jc.menu(e,{content:acts,highlight:!1})};