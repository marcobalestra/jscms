jc.maint={prop:{full:{}},prog:options=>{if(!jc.maint.prop.swal)return jc.maint.prop.swal=Swal.fire({toast:!0,title:'<div class="jcProgressbar"></div>',html:" ",position:"top-end",showConfirmButton:!1}),setTimeout(()=>{jc.maint.prog(options)},10);if(options.close){try{Swal.close()}catch(e){}try{jc.maint.prop.swal._destroy()}catch(e){}delete jc.maint.prop.swal}else{let newopts={};options.text&&(newopts.html=`${options.text}`),options.prog&&(newopts.title=`<div class="jcProgressbar"><div style="width:${100*options.prog}%;"></div></div>`),jc.maint.prop.swal.update(newopts)}},start:()=>{jc.maint.proc({})},proc:params=>{if(!jc.maint.prop.uploads)return jc.maint.prog({text:"Listing uploads…"}),void jc.jdav.ls({dir:"uploads"},x=>{jc.maint.prop.uploads={},jc.maint.prop.uploadsOrphans={},x.list.forEach(k=>{jc.maint.prop.uploads[k]=!0,jc.maint.prop.uploadsOrphans[k]=!0}),setTimeout(()=>{jc.maint.proc(params)},10)});if(jc.maint.prop.tags||(jc.maint.prop.tagnames=[],jc.maint.prop.tags={},AS.def.arr(jc.prop.site&&jc.prop.site.tags).forEach(x=>{jc.maint.prop.tagnames.push(x.name),jc.maint.prop.tags[x.name]={}})),!params.scanlist&&!params.tobescanned)return params.initial={page:jc.page.current(),id:jc.page.data().id},params.afterscan||(params.afterscan=()=>{jc.maint.scan(()=>{setTimeout(()=>{jc.maint.proc(params)},10)})}),jc.maint.prog({text:"Listing pages…"}),void jc.jdav.ls({dir:"pages"},x=>{params.tobescanned=x.list,params.totpages=x.list.length,setTimeout(()=>{jc.maint.proc(params)},10)});if(params.tobescanned){let isfirst=!1;params.scanlist||($(document.body).on("jc_page_open_completed",params.afterscan),params.scanlist=[],isfirst=!0);let nxt=params.tobescanned.shift();jc.maint.prog({text:"Loading page…",prog:parseInt(10*(params.totpages-params.tobescanned.length)/params.totpages)/10}),params.scanlist.push(nxt),params.tobescanned.length||delete params.tobescanned;var page=nxt.replace(/^([^0-9.]+).*/,"$1"),k=nxt.match(/^[^0-9]+[0-9]+\..*$/)?parseInt(nxt.replace(/^[^0-9]+([0-9]+)\..*$/,"$1")):void 0;isfirst&&page==params.initial.page&&k==params.initial.id?(params.tobescanned.push(params.scanlist.pop()),setTimeout(()=>{jc.maint.proc(params)},10)):jc.page.open(page,k)}else{if(params.afterscan&&($(document.body).off("jc_page_open_completed",params.afterscan),delete params.afterscan),!params.listsPurged)return jc.maint.prog({text:"Deleting old lists…",prog:0}),params.tbdLists?void(params.tbdLists.length?(jc.maint.prog({prog:parseInt(10*(params.tbdCount-params.tbdLists.length)/params.tbdCount)/10}),jc.dav.rm("struct/"+params.tbdLists.shift(),()=>{setTimeout(()=>{jc.maint.proc(params)},10)})):(params.listsPurged=!0,delete params.tbdLists,delete params.tbdCount,setTimeout(()=>{jc.maint.proc(params)},10))):(jc.jdav.ls({dir:"struct",ext:"rss"},x=>{x.list.forEach(k=>{jc.dav.rm("struct/"+k,()=>{})})}),void jc.jdav.ls({dir:"struct"},x=>{params.tbdLists=x.list,params.tbdCount=params.tbdLists.length,setTimeout(()=>{jc.maint.proc(params)},10)}));if(!params.savedFullList)return jc.maint.prog({text:"Saving full list…",prog:0}),void jc.lists.list.set(jc.maint.prop.full,()=>{jc.maint.prog({prog:.3}),jc.page.makeLasts(jc.maint.prop.full,()=>{params.savedFullList=!0,setTimeout(()=>{jc.maint.proc(params)},10)})});if(params.savedTypeLists){if(!params.savedTagsLists)return params.tagnames||(params.tagnames=jc.maint.prop.tagnames.clone(),params.tagnamesCount=params.tagnames.length),void(params.tagnames.length?(k=params.tagnames.shift(),jc.maint.prog({text:"Saving tags: "+k,prog:parseInt(10*(params.tagnamesCount-params.tagnames.length)/params.tagnamesCount)/10}),jc.lists.tag.set(k,jc.maint.prop.tags[k],()=>{setTimeout(()=>{jc.maint.proc(params)},10)})):(params.savedTagsLists=!0,delete params.tagnames,delete params.tagnamesCount,setTimeout(()=>{jc.maint.proc(params)},10)));jc.maint.prog({close:!0}),jc.maint.prop={full:{}},jc.page.open(params.initial.page,params.initial.id)}else if(params.ptypes||(params.ptypes=Object.keys(jc.maint.prop.full),params.ptypesCount=params.ptypes.length),params.ptypes.length){let k=params.ptypes.shift();jc.maint.prog({text:"Saving type: "+k,prog:parseInt(10*(params.ptypesCount-params.ptypes.length)/params.ptypesCount)/10}),jc.lists.list.set(k,jc.maint.prop.full[k],()=>{jc.page.makeTypeLasts(k,jc.maint.prop.full[k],()=>{jc.page.makeTypeDates(k,jc.maint.prop.full[k],()=>{setTimeout(()=>{jc.maint.proc(params)},10)})})})}else params.savedTypeLists=!0,delete params.ptypes,delete params.ptypesCount,setTimeout(()=>{jc.maint.proc(params)},10)}},scan:cb=>{let pd=jc.page.data().pageContent;var page=jc.page.current();jc.maint.prog({text:"Scan: "+pd.metadata.title});let nm=JSON.parse(JSON.stringify(pd.metadata));pd.blogdate&&(nm.date=pd.blogdate),jc.maint.prop.full[page]||(jc.maint.prop.full[page]={}),jc.maint.prop.full[page][String(pd.id||0)]=nm;let pdtags=jc.objFindAll(pd,"type","tags").clone();jc.maint.prop.tagnames.forEach(tagname=>{jc.maint.prop.tags[tagname]=jc.page.parseTagsOne(pd,tagname,jc.maint.prop.tags[tagname],pdtags)}),jc.dav.rm(AS.path("jsdatastatics")+page+(pd.id||"")+".html",()=>{jc.page.makeStatic(cb)})}};