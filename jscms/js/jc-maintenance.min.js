jc.maint={prop:{full:{}},prog:options=>{if(Swal.getContainer()||Swal.fire({toast:!0,title:'<div class="jcProgressbar"></div>',html:" ",position:"top-end",showConfirmButton:!1}),!Swal.isVisible())return setTimeout(()=>{jc.maint.prog(options)},10);let newopts={};options.text&&(newopts.html=`${options.text}`),options.prog&&(newopts.title=`<div class="jcProgressbar"><div style="width:${100*options.prog}%;"></div></div>`),Swal.update(newopts)},start:()=>{jc.maint.proc({})},proc:params=>{if(!jc.maint.prop.uploads)return jc.maint.prog({text:"Listing uploads…"}),void jc.jdav.ls({dir:"uploads"},x=>{jc.maint.prop.uploads={},jc.maint.prop.uploadsOrphans={},x.list.forEach(k=>{jc.maint.prop.uploads[k]=!0,jc.maint.prop.uploadsOrphans[k]=!0}),jc.maint.proc(params)});if(!params.scanlist&&!params.tobescanned)return params.initial={page:jc.page.current(),id:jc.page.data().id},params.afterscan||(params.afterscan=()=>{jc.maint.scan(()=>{jc.maint.proc(params)})}),jc.maint.prog({text:"Listing pages…"}),void jc.jdav.ls({dir:"pages"},x=>{params.tobescanned=x.list,params.totpages=x.list.length,jc.maint.proc(params)});if(params.tobescanned){let isfirst=!1;params.scanlist||($(document.body).on("jc_page_open_completed",params.afterscan),params.scanlist=[],isfirst=!0);let nxt=params.tobescanned.shift();jc.maint.prog({text:"Loading page…",prog:parseInt(10*(params.totpages-params.tobescanned.length)/params.totpages)/10}),params.scanlist.push(nxt),params.tobescanned.length||delete params.tobescanned;var page=nxt.replace(/^([^0-9.]+).*/,"$1"),id=nxt.match(/^[^0-9]+[0-9]+\..*$/)?parseInt(nxt.replace(/^[^0-9]+([0-9]+)\..*$/,"$1")):void 0;isfirst&&page==params.initial.page&&id==params.initial.id?params.afterscan():jc.page.open(page,id)}else{if(params.afterscan&&($(document.body).off("jc_page_open_completed",params.afterscan),delete params.afterscan),!params.listsPurged)return jc.maint.prog({text:"Deleting old lists…",prog:0}),params.tbdLists?void(params.tbdLists.length?(jc.maint.prog({prog:parseInt(10*(params.tbdCount-params.tbdLists.length)/params.tbdCount)/10}),jc.dav.rm("struct/"+params.tbdLists.shift(),()=>{jc.maint.proc(params)})):(params.listsPurged=!0,delete params.tbdLists,delete params.tbdCount,jc.maint.proc(params))):(jc.jdav.ls({dir:"struct",ext:"rss"},x=>{x.list.forEach(k=>{jc.dav.rm("struct/"+k,()=>{})})}),void jc.jdav.ls({dir:"struct"},x=>{params.tbdLists=x.list,params.tbdCount=params.tbdLists.length,jc.maint.proc(params)}));if(!params.savedFullList)return jc.maint.prog({text:"Saving full list…",prog:0}),void jc.lists.list.set(jc.maint.prop.full,()=>{jc.maint.prog({prog:.3}),jc.page.makeLasts(jc.maint.prop.full,()=>{params.savedFullList=!0,jc.maint.proc(params)})});if(params.savedTypeLists)Swal.close(),jc.page.open(params.initial.page,params.initial.id);else if(params.ptypes||(params.ptypes=Object.keys(jc.maint.prop.full),params.ptypesCount=params.ptypes.length),params.ptypes.length){let k=params.ptypes.shift();jc.maint.prog({text:"Saving type: "+k,prog:parseInt(10*(params.ptypesCount-params.ptypes.length)/params.ptypesCount)/10}),jc.lists.list.set(k,jc.maint.prop.full[k],()=>{jc.page.makeTypeLasts(k,jc.maint.prop.full[k],()=>{jc.page.makeTypeDates(k,jc.maint.prop.full[k],()=>{jc.maint.proc(params)})})})}else params.savedTypeLists=!0,delete params.ptypes,delete params.ptypesCount,jc.maint.proc(params)}},scan:cb=>{var pd=jc.page.data().pageContent,page=jc.page.current();jc.maint.prog({text:"Scan: "+pd.metadata.title});let nm=Object.assign(pd.metadata);pd.blogdate&&(nm.date=pd.blogdate),jc.maint.prop.full[page]||(jc.maint.prop.full[page]={}),jc.maint.prop.full[page][String(pd.id||0)]=nm,jc.dav.rm(AS.path("jsdatastatics")+page+(pd.id||"")+".html",()=>{jc.page.makeStatic(cb)})}};